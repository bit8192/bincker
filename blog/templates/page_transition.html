<!-- 页面过渡动画 -->
<!-- 不能依赖任何其他文件和库 -->
<!-- 只能包含<style>和<script>标签 -->
{{ define "page_transition" }}
<style id="page-transition-style">
  :root {
    --pt-ink: #0c1117;
    --pt-ink-soft: #151c26;
    --pt-sand: #f4efe5;
    --pt-sand-muted: rgba(244, 239, 229, 0.68);
    --pt-ember: #ff6b3d;
    --pt-sky: #7ab5ff;
    --pt-mint: #78d6c4;
  }

  body {
    overflow: hidden;
  }

  #page-transition {
      position: fixed;
      inset: 0;
      z-index: 1000;
      display: grid;
      place-items: center;
      background: radial-gradient(circle at 12% 18%, rgba(255, 107, 61, 0.32), transparent 58%),
      radial-gradient(circle at 85% 15%, rgba(122, 181, 255, 0.24), transparent 52%),
      radial-gradient(circle at 18% 80%, rgba(120, 214, 196, 0.2), transparent 60%),
      linear-gradient(150deg, rgba(9, 12, 17, 0.98), rgba(16, 21, 29, 0.98));
      opacity: 1;
      transition: opacity 0.6s ease, visibility 0.6s ease;
      overflow: hidden;
  }

  #page-transition[data-state="out"] {
      opacity: 0;
      visibility: hidden;
  }

  #page-transition::before {
    content: "";
    position: absolute;
    inset: -20% 0;
    background-image: linear-gradient(transparent 92%, rgba(244, 239, 229, 0.08) 100%),
    linear-gradient(90deg, transparent 92%, rgba(244, 239, 229, 0.08) 100%);
    background-size: 40px 40px;
    opacity: 0.35;
    animation: pt-grid 5s linear infinite;
    mix-blend-mode: soft-light;
  }

  #page-transition::after {
      content: "";
      position: absolute;
      inset: 0;
      opacity: 0.25;
      mix-blend-mode: soft-light;
  }

  .pt-dots {
    display: inline-flex;
    gap: 1rem;
    margin-top: 0.9rem;
    justify-content: center;
  }

  .pt-dots span {
    width: 1.4rem;
    height: 1.4rem;
    background: var(--pt-ember);
    opacity: 0.35;
    animation: pt-dot 1.1s ease-in-out infinite;
  }

  .pt-dots span:nth-child(2) {
    animation-delay: 0.2s;
    background: var(--pt-sky);
  }

  .pt-dots span:nth-child(3) {
    animation-delay: 0.4s;
    background: var(--pt-mint);
  }

  @keyframes pt-dot {
    0%,
    100% {
      transform: translateY(0);
      opacity: 0.4;
    }
    50% {
      transform: translateY(-6px);
      opacity: 1;
    }
  }

  @keyframes pt-grid {
    from {
      transform: translateY(0);
    }
    to {
      transform: translateY(40px);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .pt-dots span {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>
<script id="page-transition-script">
  (function () {
    function createElement(tagName, option, children) {
      const element = document.createElement(tagName);
      if (option) {
        Object.keys(option).forEach(function (key) {
          const value = option[key];
          if (value && typeof value === "object") {
            Object.assign(element[key], value);
          } else {
            element[key] = value;
          }
        });
      }
      if (children && children.length) {
        children.forEach(function (child) {
          if (child) {
            element.append(child);
          }
        });
      }
      return element;
    }

    function buildTransition() {
      return createElement("div", {id: "page-transition"}, [
        createElement("div", { className: "pt-dots" }, [
          document.createElement("span"),
          document.createElement("span"),
          document.createElement("span"),
        ])
      ]);
    }

    const transition = buildTransition();
    document.documentElement.append(transition);

    function dismiss() {
      transition.setAttribute("data-state", "out");
      transition.addEventListener("transitionend", function () {
        transition.remove();
        const styleTag = [...document.head.childNodes].find(i=>i.id === "page-transition-style")
        if (styleTag) styleTag.remove()
        const scriptTag = document.getElementById("page-transition-script")
        if (scriptTag) scriptTag.remove()
      });
      window.removeEventListener("load", dismiss);
    }

    window.addEventListener("load", function () {
      setTimeout(dismiss, 500);
    });
  })();
</script>
{{ end }}
