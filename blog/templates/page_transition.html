<!-- 页面过渡动画 -->
<!-- 不能依赖任何其他文件和库 -->
<!-- 只能包含<style>和<script>标签 -->
{{ define "page_transition" }}
<style id="page-transition-style">
  :root {
    --pt-ink: #0c1117;
    --pt-ink-soft: #151c26;
    --pt-sand: #f4efe5;
    --pt-sand-muted: rgba(244, 239, 229, 0.68);
    --pt-ember: #ff6b3d;
    --pt-sky: #7ab5ff;
    --pt-mint: #78d6c4;
  }

  body {
    overflow: hidden;
  }

  #page-transition {
    position: fixed;
    inset: 0;
    z-index: 1000;
    display: grid;
    place-items: center;
    background: radial-gradient(circle at 12% 18%, rgba(255, 107, 61, 0.32), transparent 58%),
      radial-gradient(circle at 85% 15%, rgba(122, 181, 255, 0.24), transparent 52%),
      radial-gradient(circle at 18% 80%, rgba(120, 214, 196, 0.2), transparent 60%),
      linear-gradient(150deg, rgba(9, 12, 17, 0.98), rgba(16, 21, 29, 0.98));
    opacity: 1;
    transition: opacity 0.6s ease, visibility 0.6s ease;
    overflow: hidden;
  }

  #page-transition[data-state="out"] {
    opacity: 0;
    visibility: hidden;
  }

  #page-transition::before {
    content: "";
    position: absolute;
    inset: -20% 0;
    background-image: linear-gradient(transparent 92%, rgba(244, 239, 229, 0.08) 100%),
      linear-gradient(90deg, transparent 92%, rgba(244, 239, 229, 0.08) 100%);
    background-size: 40px 40px;
    opacity: 0.35;
    animation: pt-grid 5s linear infinite;
    mix-blend-mode: soft-light;
  }

  #page-transition::after {
    content: "";
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.14'/%3E%3C/svg%3E");
    opacity: 0.25;
    mix-blend-mode: soft-light;
  }

  .pt-core {
    position: relative;
    width: min(280px, 70vw);
    height: min(280px, 70vw);
    display: grid;
    place-items: center;
    text-align: center;
    color: var(--pt-sand);
  }

  .pt-orbit {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    border: 1px solid rgba(244, 239, 229, 0.15);
    box-shadow: 0 0 40px rgba(255, 107, 61, 0.2), inset 0 0 30px rgba(122, 181, 255, 0.14);
    animation: pt-breath 4s ease-in-out infinite;
  }

  .pt-ring {
    position: absolute;
    border-radius: 50%;
    border: 1px solid rgba(244, 239, 229, 0.35);
    animation: pt-spin 2.8s linear infinite;
  }

  .pt-ring.ring-a {
    width: 82%;
    height: 82%;
    border-color: rgba(255, 107, 61, 0.6);
  }

  .pt-ring.ring-b {
    width: 62%;
    height: 62%;
    border-style: dashed;
    border-color: rgba(122, 181, 255, 0.55);
    animation-direction: reverse;
  }

  .pt-ring.ring-c {
    width: 42%;
    height: 42%;
    border-color: rgba(120, 214, 196, 0.6);
    animation-duration: 2.1s;
  }

  .pt-spark {
    position: absolute;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 199, 139, 0.9), rgba(255, 107, 61, 0));
    filter: blur(0.5px);
    animation: pt-orbit 2.8s ease-in-out infinite;
  }

  .pt-title {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
    letter-spacing: 0.24em;
    font-size: 0.9rem;
    text-transform: uppercase;
  }

  .pt-title strong {
    font-size: 1.1rem;
    letter-spacing: 0.32em;
  }

  .pt-sub {
    font-size: 0.75rem;
    color: var(--pt-sand-muted);
    letter-spacing: 0.38em;
  }

  .pt-progress {
    margin-top: 1.1rem;
    height: 8px;
    border-radius: 999px;
    background: rgba(244, 239, 229, 0.08);
    overflow: hidden;
    position: relative;
  }

  .pt-progress::before {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, rgba(255, 107, 61, 0.1), rgba(255, 107, 61, 0.7), rgba(122, 181, 255, 0.4), rgba(120, 214, 196, 0.6));
    background-size: 200% 100%;
    animation: pt-shimmer 1.4s linear infinite;
  }

  .pt-dots {
    display: inline-flex;
    gap: 0.25rem;
    margin-top: 0.9rem;
    justify-content: center;
  }

  .pt-dots span {
    width: 6px;
    height: 6px;
    border-radius: 999px;
    background: var(--pt-ember);
    opacity: 0.35;
    animation: pt-dot 1.1s ease-in-out infinite;
  }

  .pt-dots span:nth-child(2) {
    animation-delay: 0.2s;
    background: var(--pt-sky);
  }

  .pt-dots span:nth-child(3) {
    animation-delay: 0.4s;
    background: var(--pt-mint);
  }

  @keyframes pt-spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  @keyframes pt-breath {
    0%,
    100% {
      transform: scale(0.97);
      opacity: 0.6;
    }
    50% {
      transform: scale(1.02);
      opacity: 1;
    }
  }

  @keyframes pt-orbit {
    0% {
      transform: rotate(0deg) translateX(42%);
      opacity: 0.6;
    }
    50% {
      opacity: 1;
    }
    100% {
      transform: rotate(360deg) translateX(42%);
      opacity: 0.6;
    }
  }

  @keyframes pt-dot {
    0%,
    100% {
      transform: translateY(0);
      opacity: 0.4;
    }
    50% {
      transform: translateY(-6px);
      opacity: 1;
    }
  }

  @keyframes pt-shimmer {
    from {
      background-position-x: 0%;
    }
    to {
      background-position-x: 200%;
    }
  }

  @keyframes pt-grid {
    from {
      transform: translateY(0);
    }
    to {
      transform: translateY(40px);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    #page-transition,
    .pt-orbit,
    .pt-ring,
    .pt-spark,
    .pt-progress::before,
    .pt-dots span {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>
<script id="page-transition-script">
  (function () {
    function createElement(tagName, option, children) {
      const element = document.createElement(tagName);
      if (option) {
        Object.keys(option).forEach(function (key) {
          const value = option[key];
          if (value && typeof value === "object") {
            Object.assign(element[key], value);
          } else {
            element[key] = value;
          }
        });
      }
      if (children && children.length) {
        children.forEach(function (child) {
          if (child) {
            element.append(child);
          }
        });
      }
      return element;
    }

    function buildTransition() {
      const dots = createElement("div", { className: "pt-dots" }, [
        document.createElement("span"),
        document.createElement("span"),
        document.createElement("span"),
      ]);

      const title = createElement("div", { className: "pt-title" }, [
        createElement("strong", { textContent: "BINCKER" }),
        createElement("span", { className: "pt-sub", textContent: "页面载入中" }),
      ]);

      const core = createElement("div", { className: "pt-core" }, [
        createElement("div", { className: "pt-orbit" }),
        createElement("div", { className: "pt-ring ring-a" }),
        createElement("div", { className: "pt-ring ring-b" }),
        createElement("div", { className: "pt-ring ring-c" }),
        createElement("span", { className: "pt-spark" }),
        createElement("div", { className: "pt-text" }, [
          title,
          createElement("div", { className: "pt-progress" }),
          dots,
        ]),
      ]);

      return createElement("div", { id: "page-transition" }, [core]);
    }

    const transition = buildTransition();
    document.documentElement.append(transition);

    function dismiss() {
      transition.setAttribute("data-state", "out");
      transition.addEventListener("transitionend", function () {
        transition.remove();
        const styleTag = [...document.head.childNodes].find(i=>i.id === "page-transition-style")
        if (styleTag) styleTag.remove()
        const scriptTag = document.getElementById("page-transition-script")
        if (scriptTag) scriptTag.remove()
      });
      window.removeEventListener("load", dismiss);
    }

    window.addEventListener("load", function () {
      setTimeout(dismiss, 420);
    });
  })();
</script>
{{ end }}
